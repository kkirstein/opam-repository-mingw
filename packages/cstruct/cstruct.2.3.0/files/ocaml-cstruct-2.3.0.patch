--- ./lib/cstruct_stubs.c
+++ ./lib/cstruct_stubs.c
@@ -15,7 +15,9 @@
  * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
  */
 
+#if !defined(_MSC_VER) || !defined(_WIN32)
 #include <sys/param.h>
+#endif
 #include <stdlib.h>
 #include <errno.h>
 #include <string.h>
@@ -74,7 +76,11 @@
 CAMLprim value
 caml_check_alignment_bigstring(value val_buf, value val_ofs, value val_alignment)
 {
+#if !defined(_MSC_VER) || !defined(_WIN32)
   uint64_t address = (uint64_t) (Caml_ba_data_val(val_buf) + Long_val(val_ofs));
+#else
+  uint64_t address = (uint64_t) ((char*)Caml_ba_data_val(val_buf) + Long_val(val_ofs));
+#endif
   int alignment = Int_val(val_alignment);
   return Val_bool(address % alignment == 0);
 }
--- ./myocamlbuild.ml
+++ ./myocamlbuild.ml
@@ -1,5 +1,5 @@
 (* OASIS_START *)
-(* DO NOT EDIT (digest: f43efae5a77d2acd4796985623006383) *)
+(* DO NOT EDIT (digest: 8f373f824c4303a3ea43262fc3eb5bf3) *)
 module OASISGettext = struct
 (* # 22 "src/oasis/OASISGettext.ml" *)
 
@@ -779,7 +779,15 @@
        [
           (["oasis_library_cstruct_ccopt"; "compile"],
             [
-               (OASISExpr.EBool true,
+               (OASISExpr.EBool true, S []);
+               (OASISExpr.EOr
+                  (OASISExpr.ETest ("system", "win32"),
+                    OASISExpr.ETest ("system", "win64")),
+                 S [A "-ccopt"; A "/Ox"]);
+               (OASISExpr.ENot
+                  (OASISExpr.EOr
+                     (OASISExpr.ETest ("system", "win32"),
+                       OASISExpr.ETest ("system", "win64"))),
                  S [A "-ccopt"; A "-O3"; A "-ccopt"; A "-Wall"])
             ])
        ];
@@ -798,6 +806,6 @@
 
 let dispatch_default = MyOCamlbuildBase.dispatch_default conf package_default;;
 
-# 802 "myocamlbuild.ml"
+# 810 "myocamlbuild.ml"
 (* OASIS_STOP *)
 Ocamlbuild_plugin.dispatch dispatch_default;;
--- ./_oasis
+++ ./_oasis
@@ -31,6 +31,9 @@
   Modules:       Cstruct
   BuildDepends:  bytes, bigarray, ocplib-endian, ocplib-endian.bigstring, sexplib
   CSources:      cstruct_stubs.c
+  if (system(win32) || system(win64))
+    CCOpt:         /Ox
+  else
   CCOpt:         -O3 -Wall
 
 Library async_cstruct
--- ./setup.ml
+++ ./setup.ml
@@ -1,7 +1,7 @@
 (* setup.ml generated for the first time by OASIS v0.4.6 *)
 
 (* OASIS_START *)
-(* DO NOT EDIT (digest: f6315f8e853b1b704f4aecfe79f3bf95) *)
+(* DO NOT EDIT (digest: 7bdc9d21ff56bc5034dec4c595f02f5c) *)
 (*
    Regenerated by OASIS v0.4.6
    Visit http://oasis.forge.ocamlcore.org for more information and
@@ -7124,7 +7124,19 @@
                       bs_build_tools = [ExternalTool "ocamlbuild"];
                       bs_c_sources = ["cstruct_stubs.c"];
                       bs_data_files = [];
-                      bs_ccopt = [(OASISExpr.EBool true, ["-O3"; "-Wall"])];
+                      bs_ccopt =
+                        [
+                           (OASISExpr.EBool true, []);
+                           (OASISExpr.EOr
+                              (OASISExpr.ETest ("system", "win32"),
+                                OASISExpr.ETest ("system", "win64")),
+                             ["/Ox"]);
+                           (OASISExpr.ENot
+                              (OASISExpr.EOr
+                                 (OASISExpr.ETest ("system", "win32"),
+                                   OASISExpr.ETest ("system", "win64"))),
+                             ["-O3"; "-Wall"])
+                        ];
                       bs_cclib = [(OASISExpr.EBool true, [])];
                       bs_dlllib = [(OASISExpr.EBool true, [])];
                       bs_dllpath = [(OASISExpr.EBool true, [])];
@@ -7693,7 +7705,7 @@
      oasis_fn = Some "_oasis";
      oasis_version = "0.4.6";
      oasis_digest =
-       Some "\190\023\1409\001|\230\224\175\179\189\027\217\229\148\017";
+       Some "R\216u\012\151\023\004\012\210\214\223\200\221G\244m";
      oasis_exec = None;
      oasis_setup_args = [];
      setup_update = false
@@ -7701,6 +7713,6 @@
 
 let setup () = BaseSetup.setup setup_t;;
 
-# 7705 "setup.ml"
+# 7717 "setup.ml"
 (* OASIS_STOP *)
 let () = setup ();;
